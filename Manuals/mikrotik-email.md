# Настраиваем Mikrotik 2 E-mail cfg backup

*В данной статье мы рассмотрим процедуру настройки автоматизации отправки .backup файлов RouterOS на e-mail по заранее определенному расписанию. Данная статья — дополнение к youtube video:*
 
 Первое что мы будем настраивать это время. Данная настройка нужна для того, чтобы RouterOS понимала с какой периодичностью и когда стоит выполнять сценарий по расписанию.

Пойдем в 
 /system SNTP client

достаточно будет указать минимум один сервер

time.google.com

или 142.250.110.18 если у вас не настроен DNS (ip/dns)

2. Далее настроим e-mail клиента на примере smtp сервера яндекс
Зайдем в tools/email

![](https://raw.githubusercontent.com/vprimin/pub/main/Manuals/images/send%20e-mail.png)

Убедимся, что все в порядке  нажав на кнопку "Send Email" 

img----

Если письмо пришло, то можем продолжать настройку дальше. 

Если нет - нужно разбираться, причин может быть несколько. Одна из самых популярных - блокировка портов на уровне фаирвола или неверный пароль от ящика и т.д. Дополнительную информацию можно будет поискать в логах системы,

Итак, мы убедились,  что письмо пришло. Приступаем к написанию самого скрипта.

Идем в system/scripts 

где выполняем создание скрипта

===img

Можете скопировать данный текст заменив значения на свои 
(адрес почты, пароль, имя файла и т.д)

```
:local EMAIL "mikrotik@skp.kz"
:local PASSWORD "qwertq-1"
:local FILENAME "Netanya"
:local MESSAGE "Please see attached file..."
:local TIME ([/system clock get time])
:local DATE ([/system clock get date])

/system backup save name=$FILENAME password=$PASSWORD
/delay 30
/tool e-mail send file=$FILENAME to=$EMAIL subject="Your MikroTik backup file Netanya of $DATE $TIME" body=$MESSAGE start-tls=yes
/delay 30
/file  remove $FILENAME
```
Данный скрипт создает .backup файл с настройками, отправляет на почту и далее удалят файл с носителя RouterOS для экономии дискового пространства во избежании заполняемости ностителя т.к. например на маршрутизаторах домашнего класса размер дискового пространства сильно ограничен.


Проверим, что все настроено хорошо путем нажатия на кнопку "Run Script". Мониторить процесс выполнения скрипта можно с помощью оснастки "Files" где можно будет наблюдать процесс создания .backup файла а также его удаления в конечном итоге. А также с помощью окна с Log файлом, где можно будет отследить событие отправки файла на почту.

Ок, надеюсь у вас все прошло также хорошо. И остался лишь последний шаг - настроить расписание выполнения вашего скрипта. 

Идем в System/Scheduler и настраиваем периодичность:


!(https://github.com/vprimin/pub/blob/main/Manuals/images/send%20e-mail.png?raw=true)

По сути в данном окне важны только два параметра (1-периодичность отправки, в данном примере это 30 дней и собственно следует указать какой именно скрипт будет выполняться в нижней части окна 

```
/system script run backup-email
```
Где, 'backup-email' это имя нашего ранее созданного скрипта.

Все. На этом настройка завершена.

P.S.

Также не забывайте периодически просматривать ваш электронный язщик с бекапами на предмет наличия писем т.к. любой автоматики свойственно давать сбои. Для удобства сортировки писем можно применить фильтрацию входящих сообщений и сортировку их по соответствующим папкам силами почтового сервиса. (сейчас все умеют так делать)

Желаю вам как можно реже пользоваться процедурой восстановления.

Надеюсь статья оказалась для вас полезной!

Пока!